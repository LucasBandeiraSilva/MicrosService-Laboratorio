# ğŸ§ª HealthFlow â€“ Plataforma de Exames Laboratoriais com MicrosserviÃ§os

Bem-vindo ao **HealthFlow**, um ecossistema de microsserviÃ§os criado para simular o fluxo completo de um laboratÃ³rio de exames: desde o cadastro do cliente, geraÃ§Ã£o da coleta, faturamento, publicaÃ§Ã£o da nota fiscal e finalizaÃ§Ã£o do resultado.

A arquitetura Ã© totalmente distribuÃ­da, com comunicaÃ§Ã£o assÃ­ncrona via **Kafka**, armazenamento de notas fiscais via **MinIO**, descoberta de serviÃ§os com **Eureka**, roteamento inteligente com **Cloud Gateway** e persistÃªncia em **MySQL**.

Prepare-se: **este projeto foi feito para despertar sua curiosidade e vontade de explorar!** ğŸš€ğŸ’‰âœ¨

---

## ğŸ—ï¸ Arquitetura do Projeto

Abaixo estÃ¡ uma visÃ£o geral da arquitetura do ecossistema HealthFlow, incluindo microsserviÃ§os, bancos de dados, comunicaÃ§Ã£o via RabbitMQ e fluxo entre os domÃ­nios:

![Arquitetura do Projeto](./docs/Diagrama-MsLab)


## ğŸ—ï¸ Arquitetura Geral

A plataforma Ã© composta pelos seguintes microsserviÃ§os:

### ğŸ”¹ **clientes-service**

ResponsÃ¡vel pelo cadastro e gerenciamento de clientes do laboratÃ³rio.

### ğŸ”¹ **produto-service**

Cadastro e consulta dos exames disponÃ­veis (ex.: Colesterol, TGP, etc.).

### ğŸ”¹ **coleta-service**

Gera pedidos de exame, consolida itens, calcula valores, processa pagamentos, e envia mensagens para o Kafka.

### ğŸ”¹ **faturamento-service**

Recebe pedidos do Kafka, muda o status para **EM_ANALISE**, gera nota fiscal via MinIO e publica novamente no Kafka.

### ğŸ”¹ **resultados-service**

Atualiza o status para **PRONTO** e gera o cÃ³digo de acompanhamento do paciente.

### ğŸ”¹ **cloudGateway**

API Gateway responsÃ¡vel pelo roteamento e balanceamento.

### ğŸ”¹ **eurekaServer**

Service discovery para registro automÃ¡tico de microsserviÃ§os.

### ğŸ”¹ **serviÃ§os**

Pasta contendo os arquivos Docker Compose para rodar banco, bucket e broker.

---

## ğŸ—„ï¸ Modelos das Entidades

### ğŸ‘¤ **Clientes**

Representa o paciente que realiza os exames.

* Nome, CPF, nascimento, telefone, e-mail.
* ValidaÃ§Ãµes completas usando Bean Validation.
* Atributo `ativo` Ã© setado automaticamente ao cadastrar.

### ğŸ§ª **Coleta**

Representa o pedido de exames.

* CÃ³digo do cliente
* Data do pedido
* Total
* Dados de pagamento
* Lista de itens
* Status do exame
* URL da nota fiscal
* CÃ³digo de acompanhamento

### ğŸ”¹ **ItemColeta**

Detalha os exames associados Ã  coleta.

* CÃ³digo do produto
* Quantidade
* Valor unitÃ¡rio

### ğŸ“¦ **Produto**

Representa os exames disponÃ­veis.

* Nome
* Valor unitÃ¡rio
* Atributo `ativo` setado automaticamente.

---

## ğŸ“¬ Fluxo de Funcionamento da Plataforma

### 1ï¸âƒ£ **Cliente realiza cadastro**

### 2ï¸âƒ£ **Pedido de coleta Ã© criado com itens e forma de pagamento**

### 3ï¸âƒ£ **Coleta publica "pedido confirmado" no Kafka**

### 4ï¸âƒ£ **Faturamento recebe e gera nota fiscal no MinIO**

### 5ï¸âƒ£ **Nota fiscal Ã© publicada novamente no Kafka**

### 6ï¸âƒ£ **Resultados recebe e finaliza o exame**

Esse pipeline torna o sistema completamente desacoplado, escalÃ¡vel e resiliente.

---

# ğŸ§ª Endpoints para Testes

A seguir, exemplos reais para testar localmente.

---

# ğŸ‘¤ Clientes (exemplos usando "**Bucky Barnes â€” O Soldado Invernal**")

### â• **Cadastrar Cliente**

```json
{
  "nome": "Bucky Barnes",
  "dataNascimento": "04/03/1917",
  "cpf": "123.123.123-87",
  "telefone": "(47) 94567-8901",
  "email": "winter.soldier@avengers.com"
}
```

### ğŸ” Obter por ID

`GET http://localhost:8080/clientes/5`

### ğŸ—‘ï¸ Deletar

`DELETE http://localhost:8080/clientes/1`

### âœï¸ Atualizar

`PUT http://localhost:8081/clientes/1`

```json
{
  "nome": "James Buchanan Barnes",
  "dataNascimento": "04/03/1917",
  "cpf": "123.123.123-87",
  "telefone": "(47) 97777-7777",
  "email": "bucky.barnes@avengers.com"
}
```

---

# ğŸ“¦ Produtos

### â• Cadastrar

```json
{
  "nome": "TGP",
  "valorUnitario": 14.35
}
```

### ğŸ” Obter por ID

`GET http://localhost:8083/produtos/2`

### ğŸ—‘ï¸ Deletar

`DELETE http://localhost:8083/produtos/3`

### ğŸ“‹ Listar todos

`GET http://localhost:8083/produtos`

### âœï¸ Atualizar

`PUT http://localhost:8083/produtos/1`

```json
{
  "nome": "Colesterol",
  "valorUnitario": 22.99
}
```

---

# ğŸ§¬ Coleta

### â• Criar Coleta

```json
{
  "codigoCliente": 2,
  "dadosPagamento": {
    "tipoPagamento": "PIX",
    "dados": 25654345675432
  },
  "itens": [
    { "codigoProduto": 2, "quantidade": 1, "valorUnitario": 10.00 },
    { "codigoProduto": 4, "quantidade": 1, "valorUnitario": 18.90 },
    { "codigoProduto": 5, "quantidade": 1, "valorUnitario": 22.99 }
  ]
}
```

### ğŸ” Simular Callback do Banco

`POST http://localhost:8080/coletas/callback-pagamentos`

```json
{
  "codigo": 1,
  "chavePagamento":"a3fe5122-6fce-49c9-b2de-9e4f2bd7313e",
  "status": true,
  "observacoes": ""
}
```

### ğŸ” Novo Pagamento (erro anterior)

```json
{
  "codigoPedido": 2,
  "tipoPagamento": "DEBITO",
  "dados": 25654345675432
}
```

### ğŸ” Obter por ID

`GET http://localhost:8080/coletas/1`

---

# ğŸ§¾ Faturamento

### ğŸ“¤ Upload da Nota Fiscal

`POST http://localhost:8080/bucket`

**form-data:**

* key: `file`
* value: arquivo.pdf / jpg / png

### ğŸ“„ Atualizar Nome da Nota

`POST http://localhost:8080/bucket?filename=NotaFiscal_Coleta_1.pdf`

---

# ğŸ§± Docker â€“ Infraestrutura Completa

Na pasta **serviÃ§os/** vocÃª encontrarÃ¡ os arquivos:

### ğŸ”¹ **database.yml** â€“ MySQL 8

### ğŸ”¹ **bucket.yml** â€“ MinIO

### ğŸ”¹ **broker.yml** â€“ Kafka + Zookeeper + Kafka UI

Cada arquivo foi pensado para ser simples, direto e ideal para desenvolvimento local.

---

# ğŸš€ Como Rodar o Projeto

1. Subir MySQL:

```bash
docker compose -f serviÃ§os/database.yml up -d
```

2. Subir MinIO:

```bash
docker compose -f serviÃ§os/bucket.yml up -d
```

3. Subir Kafka:

```bash
docker compose -f serviÃ§os/broker.yml up -d
```

4. Rodar Eureka
5. Rodar Cloud Gateway
6. Rodar microsserviÃ§os na ordem desejada

---

# ğŸ¯ Objetivo do Projeto

O HealthFlow foi criado para demonstrar:

* MicrosserviÃ§os com comunicaÃ§Ã£o assÃ­ncrona
* IntegraÃ§Ã£o com Kafka
* Upload de arquivos com MinIO
* Balanceamento de carga com Gateway
* Service discovery com Eureka
* Boas prÃ¡ticas em arquitetura limpa e validaÃ§Ãµes

Este projeto foi feito **para ser explorado, quebrado, modificado, testado e expandido!**

Se vocÃª gosta de arquitetura real, escalÃ¡vel, com mensageria, arquivos e mÃºltiplos serviÃ§os, o HealthFlow vai te prender.

---

# ğŸ¦¾ Contribua

Sinta-se livre para clonar, testar, enviar PRs, reportar issues, ou atÃ© adaptar para novos cenÃ¡rios.

O laboratÃ³rio Ã© seu agora. ğŸ§¬ğŸ§ªğŸ”¥

---

# ğŸ›¡ï¸ Autor

Desenvolvido por **Lucas Bandeira da Silva**.

Se precisar de ajuda, ajustes ou quiser criar os READMEs individuais dos microsserviÃ§os, Ã© sÃ³ chamar.
